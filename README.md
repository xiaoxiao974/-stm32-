![IMG_20250318_184705](https://github.com/user-attachments/assets/7ae3246b-3fe9-46c2-9ae7-64aa31cc1ab5)
# 基于STM32的智能环境监测与控制系统

本项目为课程作业，旨在通过STM32微控制器实现环境参数的实时监测与自动调节。系统综合运用了GPIO、定时器、ADC、通信接口、中断等模块，具备光照强度检测、温湿度监测、风扇控制、数据展示等功能。

## 功能概述

### 基础功能
- **硬件搭建**  
  - 主控：STM32F103C8T6最小系统板  
  - 传感器：光敏传感器（ADC读取）、DHT11温湿度传感器  
  - 执行机构：直流电机（风扇）、蜂鸣器  
  - 显示模块：OLED（I2C接口）  
  - 其他：LED状态灯、按键控制  

- **GPIO与按键控制**  
  - 按键1：系统启停控制（`My_System_SE_Flag`切换运行/暂停）  
  - 按键2：模式切换（平衡模式/超能模式，通过串口指令控制）  
  - LED：PA0引脚指示系统运行状态（高电平运行，低电平休眠）  

- **ADC与传感器数据采集**  
  - 光敏传感器：模拟信号转换为光照强度百分比（0~100%）  
  - DHT11：温度数据采集，触发蜂鸣器报警  

- **定时器与PWM控制**  
  - 风扇转速控制：根据温度动态调整PWM占空比  
    - 温度 >34°C: 60% + 模式加成  
    - 温度 32-34°C: 50% + 模式加成  
    - 温度 28-32°C: 30% + 模式加成  
    - 温度 <28°C: 20% + 模式加成  

- **OLED显示**  
  实时显示以下信息：  
  - 当前时间（RTC模块）  
  - 光照强度百分比  
  - 温度值  
  - 风扇转速百分比  
  - 运行模式（`B`-平衡模式，`S`-超能模式）  

- **中断系统**  
  - 外部中断处理按键事件  
  - 定时中断实现数据采集与显示刷新  

### 进阶功能
- **温湿度报警**  
  - 温度超过34°C时，蜂鸣器鸣响并串口发送`Warning!`  
  - 超能模式下风扇转速额外增加10%  

- **数据存储与RTC**  
  - 使用RTC模块记录数据时间戳  
  - OLED显示实时时间  

- **独立看门狗（IWDG）**  
  - 超时时间10秒，系统异常时自动复位  

- **串口通信**  
  - 支持指令控制运行模式：  
    - `MODE_SUPER`：切换至超能模式，回复`MODE_SUPER_OK`  
    - `MODE_BALANCE`：切换至平衡模式，回复`MODE_BALANCE_OK`  

## 代码结构
```plaintext
main.c
├── Module_Init()         // 初始化所有外设
├── IWDG_Init()           // 看门狗配置
├── GPIO_Configuration()  // PA0引脚输出配置
├── Display_Time()        // RTC时间显示
├── Select_Mode()         // 模式切换与加成计算
├── Display_Light()       // 光照强度显示
├── Display_Temperature_And_Control_Buzzer() // 温度显示与蜂鸣器控制
├── Control_Fan_By_Temperature() // 温度-PWM映射
└── Handle_Sleep_Mode()   // 休眠模式处理
